<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo de Libros</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="catalog-content container">
  <div class="catalog-controls">
    <div class="search-container">
      <input type="text" id="search" placeholder="Buscar por título, autor, editorial...">
      <button onclick="filtrar()">Buscar</button>
    </div>
  </div>
  <div id="contenido" class="books-grid"></div>
</div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTJn_PAdSHSPWifkBLr9h8MyhrQ8IK-c0XjoT-tlJoWm6TuLXLO5QD2vNoyXONLIKVsUSRcRWseS2yD/pubhtml"; // <-- pon tu URL aquí
let libros = [];

async function cargarDatos() {
  const res = await fetch(sheetUrl);
  const texto = await res.text();
  const filas = texto.split("\n").map(f => f.split(","));
  const headers = filas[0];
  libros = filas.slice(1).map(fila => {
    let obj = {};
    headers.forEach((h,i) => obj[h.trim()] = fila[i] || "");
    return obj;
  });
  renderCatalogo(libros);
}

function getQuery(param) {
  return new URLSearchParams(window.location.search).get(param);
}

function renderCatalogo(lista) {
  const cont = document.getElementById("contenido");
  cont.innerHTML = "";
  lista.forEach(l => {
    const div = document.createElement("div");
    div.className = "book-card";
    div.innerHTML = `
      <div class="book-image">
        <img src="${l['Foto 1'] || ''}" alt="Portada">
      </div>
      <div class="book-info">
        <h3>${l['Título']}</h3>
        <p class="author">${l['Autor']}</p>
        <p class="price">${l['Precio de venta']} €</p>
        <a class="btn btn-primary" href="?isbn=${l['ISBN']}">Ver más</a>
      </div>
    `;
    cont.appendChild(div);
  });
}

function renderProducto(libro) {
  const cont = document.getElementById("contenido");
  cont.className = "book-detail-container";
  let fotos = [libro['Foto 1'], libro['Foto 2'], libro['Foto 3']].filter(x => x);
  cont.innerHTML = `
    <div class="book-detail">
      <div class="book-image-container">
        <img id="foto-actual" src="${fotos[0] || ''}" class="book-image">
        <div>
          <button onclick="cambiarFoto(-1, ${JSON.stringify(fotos)})">Anterior</button>
          <button onclick="cambiarFoto(1, ${JSON.stringify(fotos)})">Siguiente</button>
        </div>
      </div>
      <div class="book-info">
        <h1>${libro['Título']}</h1>
        <p><b>Autor:</b> ${libro['Autor']}</p>
        <p><b>Editorial:</b> ${libro['Editorial']}</p>
        <p><b>Año:</b> ${libro['Año de publicación']}</p>
        <p><b>Edición:</b> ${libro['Edición']}</p>
        <p><b>Estado general:</b> ${libro['Estado general']}</p>
        <p><b>Detalles de desgaste:</b> ${libro['Detalles de desgaste']}</p>
        <p><b>Observaciones:</b> ${libro['Observaciones']}</p>
        <p class="book-price">${libro['Precio de venta']} €</p>
        <p><b>Descuento:</b> ${libro['Descuento']}</p>
        <p><b>Stock:</b> ${libro['Stock']}</p>
        <p><b>Fecha alta:</b> ${libro['Fecha de alta en inventario']}</p>
        <p><b>Ubicación:</b> ${libro['Ubicación']}</p>
        <p><b>Sinopsis:</b> ${libro['Sinopsis breve']}</p>
        <p><b>Características:</b> ${libro['Características destacadas']}</p>
        <p><b>Palabras clave:</b> ${libro['Palabras clave']}</p>
        <p><b>Peso:</b> ${libro['Peso (g)']} g</p>
        <p><b>Dimensiones:</b> ${libro['Dimensiones (cm)']}</p>
        <p><b>Disponibilidad:</b> ${libro['Disponibilidad envío inmediato']}</p>
        <div class="book-actions">
          <a class="btn btn-primary" href="${libro['y']}" target="_blank">Comprar en Wallapop</a>
          <a class="btn btn-secondary" href="index.html">Volver</a>
        </div>
      </div>
    </div>
  `;
}

let fotoIndex = 0;
function cambiarFoto(dir, fotos) {
  if (!fotos.length) return;
  fotoIndex = (fotoIndex + dir + fotos.length) % fotos.length;
  document.getElementById("foto-actual").src = fotos[fotoIndex];
}

function filtrar() {
  const q = document.getElementById("search").value.toLowerCase();
  const filtrados = libros.filter(l =>
    l['Título'].toLowerCase().includes(q) ||
    l['Autor'].toLowerCase().includes(q) ||
    l['Editorial'].toLowerCase().includes(q) ||
    l['Palabras clave'].toLowerCase().includes(q)
  );
  renderCatalogo(filtrados);
}

cargarDatos().then(() => {
  const isbn = getQuery("isbn");
  if (isbn) {
    const libro = libros.find(l => l["ISBN"] === isbn);
    if (libro) renderProducto(libro);
  }
});
</script>

</body>
</html>

