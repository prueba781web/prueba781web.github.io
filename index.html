<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Catálogo de Libros</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    h1 { text-align: center; }
    .catalogo { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
    .libro { background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
    .libro img { max-width: 100%; height: 200px; object-fit: cover; border-radius: 6px; }
    .libro h3 { margin: 10px 0 5px; font-size: 16px; }
    .libro p { margin: 5px 0; font-size: 14px; color: #555; }
    .btn { display: inline-block; margin-top: 10px; padding: 8px 12px; background: #0077cc; color: white; border-radius: 5px; text-decoration: none; }
    .btn:hover { background: #005fa3; }
    .producto { max-width: 700px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .producto img { max-width: 200px; margin: 10px; border-radius: 6px; }
    .imagenes { display: flex; flex-wrap: wrap; gap: 10px; }
  </style>
</head>
<body>

<h1>Catálogo de Libros</h1>
<div id="contenido"></div>

<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTJn_PAdSHSPWifkBLr9h8MyhrQ8IK-c0XjoT-tlJoWm6TuLXLO5QD2vNoyXONLIKVsUSRcRWseS2yD/pub?output=csv"; // <-- pon aquí tu enlace

async function cargarDatos() {
  const res = await fetch(sheetUrl);
  const texto = await res.text();
  const filas = texto.split("\n").map(f => f.split(","));
  const headers = filas[0];
  const datos = filas.slice(1).map(fila => {
    let obj = {};
    headers.forEach((h,i) => obj[h.trim()] = fila[i] || "");
    return obj;
  });
  return datos;
}

function getQuery(param) {
  return new URLSearchParams(window.location.search).get(param);
}

function mostrarCatalogo(libros) {
  const cont = document.getElementById("contenido");
  cont.className = "catalogo";
  cont.innerHTML = "";
  libros.forEach(l => {
    const div = document.createElement("div");
    div.className = "libro";
    div.innerHTML = `
      <img src="${l['Foto 1'] || ''}" alt="Portada">
      <h3>${l['Título']}</h3>
      <p>${l['Autor']}</p>
      <a class="btn" href="?isbn=${l['ISBN']}">Ver más</a>
    `;
    cont.appendChild(div);
  });
}

function mostrarProducto(libro) {
  const cont = document.getElementById("contenido");
  cont.className = "producto";
  cont.innerHTML = `
    <h2>${libro['Título']}</h2>
    <p><b>Autor:</b> ${libro['Autor']}</p>
    <p><b>Editorial:</b> ${libro['Editorial']}</p>
    <p><b>Año:</b> ${libro['Año de publicación']}</p>
    <p><b>Estado:</b> ${libro['Estado general']}</p>
    <p><b>Precio:</b> ${libro['Precio de venta']} €</p>
    <p><b>Sinopsis:</b> ${libro['Sinopsis breve']}</p>
    <div class="imagenes">
      <img src="${libro['Foto 1']}" alt="">
      <img src="${libro['Foto 2']}" alt="">
      <img src="${libro['Foto 3']}" alt="">
    </div>
    <a class="btn" href="${libro['y']}" target="_blank">Comprar en Wallapop</a>
    <br><br>
    <a href="index.html">Volver al catálogo</a>
  `;
}

cargarDatos().then(libros => {
  const isbn = getQuery("isbn");
  if (isbn) {
    const libro = libros.find(l => l["ISBN"] === isbn);
    if (libro) mostrarProducto(libro);
    else document.getElementById("contenido").innerHTML = "Libro no encontrado";
  } else {
    mostrarCatalogo(libros);
  }
});
</script>

</body>
</html>
